"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/common.js");if(!Array){(e.resolveComponent("uni-dateformat")+e.resolveComponent("uni-icons"))()}Math||((()=>"../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js"))();const l={__name:"comment-item",props:{subReply:{type:Boolean,default:!1},item:Object,reply:{type:Boolean,default:!1},toplevel:{type:Boolean,default:!1}},emits:["reply"],setup(l,{emit:o}){const a=o,i=e.ref(e.Vs.getCurrentUserInfo().uid),u=e.Vs.database(),n=l,s=e.ref(n.item),r=()=>{n.subReply&&(e.index.navigateTo({url:"/pages/detail/reply"}),e.index.setStorageSync("currentReply",n.item)),n.reply&&a("reply",n.item)};e.watch((()=>n.item),(e=>{s.value=e}),{deep:!0,immediate:!0});const d=async()=>{console.log(s.value)},c=e.debounce((async function(){s.value.isLike?(s.value.like_count--,u.collection("soup-like").where({soup_id:s.value.soup_id,comment_id:s.value._id,user_id:i.value,like_type:1}).remove()):(s.value.like_count++,u.collection("soup-like").add({soup_id:s.value.soup_id,comment_id:s.value._id,like_type:1}));s.value.isLike=!s.value.isLike,e.index.$emit("commentLike",{_id:s.value._id,isLike:s.value.isLike,like_count:s.value.like_count})}),1e3,{leading:!0,trailing:!1});return(o,a)=>e.e({a:s.value.userInfo.avatar||"../../static/images/defAvatar.png",b:e.t(s.value.userInfo.username),c:e.p({date:s.value.comment_date,threshold:[6e4,36e5],format:"yyyy/MM/dd hh:mm"}),d:s.value.like_count>0},s.value.like_count>0?{e:e.t(s.value.like_count),f:s.value.isLike?"#dd524d":"#a7a7a7"}:{},{g:!s.value.isLike},s.value.isLike?{i:e.p({type:"hand-up-filled",size:"20",color:"#dd524d"})}:{h:e.p({type:"hand-up",size:"20",color:"#a7a7a7"})},{j:e.o(((...t)=>e.unref(c)&&e.unref(c)(...t))),k:!l.toplevel&&!s.value.is_delete&&(s.value.userInfo._id==i.value||e.unref(t.isAdminRole)())},l.toplevel||s.value.is_delete||s.value.userInfo._id!=i.value&&!e.unref(t.isAdminRole)()?{}:{l:e.p({type:"trash",size:"20",color:"#a7a7a7"}),m:e.o(d)},{n:e.t(s.value.comment_content),o:e.n(s.value.is_delete?"isDelete":""),p:s.value.replyInfo},s.value.replyInfo?{q:e.t(s.value.replyInfo.userInfo.username),r:e.t(s.value.replyInfo.comment_content)}:{},{s:e.o(r),t:l.subReply&&s.value.childCount},l.subReply&&s.value.childCount?{v:e.f(s.value.child,((t,l,o)=>({a:e.t(t.userInfo.username),b:e.t(t.comment_content),c:t._id}))),w:e.t(s.value.childCount),x:e.p({type:"right",color:"#a7a7a7",size:"16"}),y:e.o(r)}:{})}},o=e._export_sfc(l,[["__scopeId","data-v-48e6a6ca"]]);wx.createComponent(o);
