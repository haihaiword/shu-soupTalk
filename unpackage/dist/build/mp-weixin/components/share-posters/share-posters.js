"use strict";const e=require("../../common/vendor.js"),o=require("../../stores/user.js");if(!Array){(e.resolveComponent("l-painter-text")+e.resolveComponent("l-painter-image")+e.resolveComponent("l-painter-view")+e.resolveComponent("l-painter")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/lime-painter/components/l-painter-text/l-painter-text.js")+(()=>"../../uni_modules/lime-painter/components/l-painter-image/l-painter-image.js")+(()=>"../../uni_modules/lime-painter/components/l-painter-view/l-painter-view.js")+(()=>"../../uni_modules/lime-painter/components/l-painter/l-painter.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const t={__name:"share-posters",props:{info:{type:Object,default:()=>({})}},setup(t,{expose:n}){const i=e.Vs.importObject("QRCode"),s=o.useUserStore(),p=e.ref(null),a=e.ref(null),r=e.ref(),l=e.ref(!1),c=e.ref(),u=async()=>{let o=await i.getUnlimited();c.value=o,e.nextTick$1((()=>{a.value.canvasToTempFilePathSync({fileType:"jpg",pathType:"url",quality:.6,success:o=>{console.log(o),r.value=o.tempFilePath,p.value.open(),e.index.hideLoading()},fail:o=>{e.index.hideLoading(),showToast(o)}})}))},d=()=>{try{e.index.showLoading({title:"下载中...",mask:!0}),e.index.getImageInfo({src:r.value,success:o=>{e.index.saveImageToPhotosAlbum({filePath:o.path,success:o=>{p.value.close(),setTimeout((()=>{e.index.showToast({title:"保存成功，请到相册查看",icon:"none"})}),500)},fail:o=>{"saveImageToPhotosAlbum:fail cancel"!=o.errMsg?e.index.showModal({title:"授权提示",content:"需要授权保存相册",success:o=>{o.confirm&&e.index.openSetting({success:o=>{console.log(o),o.authSetting["scope.writePhotosAlbum"]?e.index.showToast({title:"获取授权成功",icon:"none"}):e.index.showToast({title:"获取权限失败",icon:"none"})}})}}):e.index.showToast({title:"保存失败，请重新点击下载",icon:"none"})},complete:()=>{e.index.hideLoading()}})}})}catch(o){console.log(o),e.index.hideLoading()}};return n({showPopup:u,handleShow:()=>{e.index.showLoading({title:"加载中..."}),l.value=!0,e.nextTick$1((()=>{u()}))}}),(o,n)=>e.e({a:l.value},l.value?{b:e.p({css:"font-size: 46rpx; line-height: 1.7em;line-clamp:6",text:t.info.content}),c:e.p({src:t.info.userInfo.avatar||"../../static/images/defAvatar.png",css:"width: 50rpx; height: 50rpx; border-radius: 50%; object-fit: cover; object-position: 50% 50%;"}),d:e.p({text:t.info.userInfo.username,css:"font-size: 30rpx;margin-left: 10rpx;line-height:50rpx;color:#555"}),e:e.p({css:"margin-top:40rpx"}),f:e.p({css:"width: 600rpx;position: absolute; top:300rpx;left:82rpx"}),g:e.p({text:`—— 来自：${e.unref(s).userInfo.username}的分享 ——`,css:"position: absolute; top:850rpx; left: 0; width:100%; text-align: center; font-size: 26rpx; color:#bbb"}),h:e.p({src:c.value,css:"position: absolute; width: 145rpx; height: 145rpx; left: 82rpx; top:955rpx;object-fit: cover;"}),i:e.sr(a,"68e7fe41-0",{k:"poster"}),j:e.p({hidden:!0,"after-delay":200,css:"width:750rpx; height: 1163rpx; background-image: url(https://mp-293d9e23-9bcc-4a7d-86ad-51eac2183ed9.cdn.bspapp.com/cloudstorage/shareBg.jpg);","custom-style":"position: fixed; top:0;left:0%;"})}:{},{k:r.value,l:e.o(d),m:e.sr(p,"68e7fe41-8",{k:"popup"}),n:e.p({"mask-background-color":"rgba(0,0,0,0.7)"})})}},n=e._export_sfc(t,[["__scopeId","data-v-68e7fe41"]]);wx.createComponent(n);
