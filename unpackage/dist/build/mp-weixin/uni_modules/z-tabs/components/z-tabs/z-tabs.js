"use strict";const t=require("../../../../common/vendor.js"),e=require("./config/index.js");function i(t,i){let o=null;if(!e.zTabsConfig||!Object.keys(e.zTabsConfig).length)return i;o=e.zTabsConfig;const n=o[function(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}(t)];return void 0===n?i:n}const o={name:"z-tabs",data:()=>({currentIndex:0,currentSwiperIndex:0,bottomDotX:-1,bottomDotXForIndex:0,showBottomDot:!1,shouldSetDx:!0,barCalcedWidth:0,pxBarWidth:0,scrollLeft:0,tabsSuperWidth:t.index.upx2px(750),tabsWidth:t.index.upx2px(750),tabsHeight:t.index.upx2px(80),tabsLeft:0,tabsContainerWidth:0,itemNodeInfos:[],isFirstLoaded:!1,currentScrollLeft:0,changeTriggerFailed:!1,currentChanged:!1}),props:{list:{type:Array,default:function(){return[]}},current:{type:[Number,String],default:i("current",0)},scrollCount:{type:[Number,String],default:i("scrollCount",5)},tabsStyle:{type:Object,default:function(){return i("tabsStyle",{})}},tabWidth:{type:[Number,String],default:i("tabWidth",0)},barWidth:{type:[Number,String],default:i("barWidth",45)},barHeight:{type:[Number,String],default:i("barHeight",8)},barStyle:{type:Object,default:function(){return i("barStyle",{})}},bottomSpace:{type:[Number,String],default:i("bottomSpace",8)},barAnimateMode:{type:String,default:i("barAnimateMode","line")},nameKey:{type:String,default:i("nameKey","name")},valueKey:{type:String,default:i("valueKey","value")},activeColor:{type:String,default:i("activeColor","#007AFF")},inactiveColor:{type:String,default:i("inactiveColor","#666666")},disabledColor:{type:String,default:i("disabledColor","#bbbbbb")},activeStyle:{type:Object,default:function(){return i("activeStyle",{})}},inactiveStyle:{type:Object,default:function(){return i("inactiveStyle",{})}},disabledStyle:{type:Object,default:function(){return i("disabledStyle",{})}},bgColor:{type:String,default:i("bgColor","white")},badgeMaxCount:{type:[Number,String],default:i("badgeMaxCount",99)},badgeStyle:{type:Object,default:function(){return i("badgeStyle",{})}},initTriggerChange:{type:Boolean,default:i("initTriggerChange",!1)}},mounted(){this.updateSubviewLayout()},watch:{current:{handler(t){this.currentChanged&&this._lockDx(),this.currentIndex=t,this._preUpdateDotPosition(this.currentIndex),this.initTriggerChange&&(t<this.list.length?this.$emit("change",t,this.list[t][this.valueKey]):this.changeTriggerFailed=!0),this.currentChanged=!0},immediate:!0},list:{handler(t){this._handleListChange(t)},immediate:!1},bottomDotX(t){t>=0&&(this.showBottomDot=!0,this.$nextTick((()=>{})))},finalBarWidth:{handler(t){this.barCalcedWidth=t,this.pxBarWidth=this.barCalcedWidth},immediate:!0},currentIndex:{handler(t){this.currentSwiperIndex=t},immediate:!0}},computed:{shouldScroll(){return this.list.length>this.scrollCount},finalTabsHeight(){return this.tabsHeight},tabStyle(){const t=this.shouldScroll?{"flex-shrink":0}:{flex:1};return this.finalTabWidth>0?t.width=this.finalTabWidth+"px":delete t.width,t},tabsListStyle(){return this.shouldScroll?{}:{flex:1}},showAnimate(){return this.isFirstLoaded&&!this.shouldSetDx},dotTransition(){return this.showAnimate?"transform .2s linear":"none"},finalDotStyle(){return{...this.barStyle,width:this.barCalcedWidth+"px",height:this.finalBarHeight+"px",opacity:this.showBottomDot?1:0}},finalTabWidth(){return this._convertTextToPx(this.tabWidth)},finalBarWidth(){return this._convertTextToPx(this.barWidth)},finalBarHeight(){return this._convertTextToPx(this.barHeight)},finalBottomSpace(){return this._convertTextToPx(this.bottomSpace)}},methods:{setDx(t){if(!this.shouldSetDx)return;const e="line"===this.barAnimateMode,i="worm"===this.barAnimateMode;let o=t/this.tabsSuperWidth;this.currentSwiperIndex=this.currentIndex+parseInt(o);const n=o>0,s=this.pxBarWidth;if(this.currentSwiperIndex!==this.currentIndex){o-=this.currentSwiperIndex-this.currentIndex;const t=this.itemNodeInfos[this.currentSwiperIndex];t&&(this.bottomDotXForIndex=this._getBottomDotX(t,s))}const r=this.currentSwiperIndex;let a=r+(n?1:-1);a=Math.max(0,a),a=Math.min(a,this.itemNodeInfos.length-1);const h=this.itemNodeInfos[r],l=this.itemNodeInfos[a],d=this._getBottomDotX(l,s);if(e)this.bottomDotX=this.bottomDotXForIndex+(d-this.bottomDotXForIndex)*Math.abs(o);else if(i){if(n&&r>=this.itemNodeInfos.length-1||!n&&r<=0)return;const t=n?l.right-h.left:h.right-l.left;let e=s+t*Math.abs(o);if(n){if(e>d-this.bottomDotX+s){const i=s+t*(1-o);this.bottomDotX=this.bottomDotXForIndex+(e-i)/2,e=i}}else if(!n)if(e>this.bottomDotXForIndex+s-d){e=s+t*(1+o),this.bottomDotX=d}else this.bottomDotX=this.bottomDotXForIndex-(e-s);e=Math.max(e,s),this.barCalcedWidth=e}},unlockDx(){this.$nextTick((()=>{this.shouldSetDx=!0}))},updateSubviewLayout(t=0){this.$nextTick((()=>{setTimeout((()=>{this._getNodeClientRect(".z-tabs-scroll-view-conatiner").then((e=>{if(e){if(!e[0].width&&t<10)return void setTimeout((()=>{t++,this.updateSubviewLayout(t)}),50);this.tabsWidth=e[0].width,this.tabsHeight=e[0].height,this.tabsLeft=e[0].left,this._handleListChange(this.list)}})),this._getNodeClientRect(".z-tabs-conatiner").then((t=>{t&&t[0].width&&(this.tabsSuperWidth=t[0].width)}))}),10)}))},tabsClick(t,e){e.disabled||(this.currentIndex!=t?(this.shouldSetDx=!1,this.$emit("change",t,e[this.valueKey]),this.currentIndex=t,this._preUpdateDotPosition(t)):this.$emit("secondClick",t,e[this.valueKey]))},scroll(t){this.currentScrollLeft=t.detail.scrollLeft},_lockDx(){this.shouldSetDx=!1},_preUpdateDotPosition(e){this.$nextTick((()=>{t.index.createSelectorQuery().in(this).select(".z-tabs-scroll-view").fields({scrollOffset:!0},(t=>{t?(this.currentScrollLeft=t.scrollLeft,this._updateDotPosition(e)):this._updateDotPosition(e)})).exec()}))},_updateDotPosition(e){e>=this.itemNodeInfos.length||this.$nextTick((async()=>{let i=this.itemNodeInfos[e],o=0,n=this.tabsContainerWidth;if("{}"!==JSON.stringify(this.activeStyle)){const s=await this._getNodeClientRect(`#z-tabs-item-${e}`,!0);if(s){i=s[0],o=this.currentScrollLeft,this.tabsHeight=Math.max(i.height+t.index.upx2px(28),this.tabsHeight),n=0;for(let t=0;t<this.itemNodeInfos.length;t++){let o=this.itemNodeInfos[t];n+=t===e?i.width:o.width}}}this.bottomDotX=this._getBottomDotX(i,this.finalBarWidth,o),this.bottomDotXForIndex=this.bottomDotX,this.tabsWidth&&setTimeout((()=>{let t=this.bottomDotX-this.tabsWidth/2+this.finalBarWidth/2;t=Math.max(0,t),n&&(t=Math.min(t,n-this.tabsWidth+10)),this.shouldScroll&&n>this.tabsWidth&&(this.scrollLeft=t),this.$nextTick((()=>{this.isFirstLoaded=!0}))}),200)}))},_handleListChange(t){this.$nextTick((async()=>{if(t.length){let e=[],i=0;setTimeout((async()=>{for(let o=0;o<t.length;o++){const t=await this._getNodeClientRect(`#z-tabs-item-${o}`,!0);if(t){const o=t[0];o.left+=this.currentScrollLeft,e.push(o),i+=o.width}o===this.currentIndex&&(this.itemNodeInfos=e,this.tabsContainerWidth=i,this._updateDotPosition(this.currentIndex))}this.itemNodeInfos=e,this.tabsContainerWidth=i,this._updateDotPosition(this.currentIndex)}),0)}})),this.initTriggerChange&&this.changeTriggerFailed&&t.length&&this.current<t.length&&this.$emit("change",this.current,t[this.current][this.valueKey])},_getBottomDotX(t,e=this.finalBarWidth,i=0){return t.left+t.width/2-e/2+i-this.tabsLeft},_getNodeClientRect(e,i=!1){const o=t.index.createSelectorQuery().in(this);return o.select(e).boundingClientRect(),new Promise(((t,e)=>{o.exec((e=>{t(!(!e||""==e||null==e||!e.length)&&e)}))}))},_formatCount(t){return t?t>this.badgeMaxCount?this.badgeMaxCount+"+":t.toString():""},_convertTextToPx(e){if("[object Number]"===Object.prototype.toString.call(e))return t.index.upx2px(e);let i=!1;return-1!==e.indexOf("rpx")||-1!==e.indexOf("upx")?(e=e.replace("rpx","").replace("upx",""),i=!0):e=-1!==e.indexOf("px")?e.replace("px",""):t.index.upx2px(e),isNaN(e)?0:Number(i?t.index.upx2px(e):e)}}};const n=t._export_sfc(o,[["render",function(e,i,o,n,s,r){return{a:t.f(o.list,((e,i,n)=>t.e({a:t.t(e[o.nameKey]||e),b:e.disabled?1:"",c:t.s({color:e.disabled?o.disabledColor:s.currentIndex===i?o.activeColor:o.inactiveColor}),d:t.s(e.disabled?o.disabledStyle:s.currentIndex===i?o.activeStyle:o.inactiveStyle),e:e.badge&&r._formatCount(e.badge.count).length},e.badge&&r._formatCount(e.badge.count).length?{f:t.t(r._formatCount(e.badge.count)),g:t.s(o.badgeStyle)}:{},{h:`z-tabs-item-${i}`,i:`z-tabs-item-${i}`,j:i,k:t.o((t=>r.tabsClick(i,e)),i)}))),b:t.s(r.tabStyle),c:t.s(r.tabsListStyle),d:t.s({marginTop:-r.finalBottomSpace+"px"}),e:t.s({transform:`translateX(${s.bottomDotX}px)`,transition:r.dotTransition,background:o.activeColor}),f:t.s(r.finalDotStyle),g:t.s({width:s.tabsContainerWidth+"px",bottom:r.finalBottomSpace+"px"}),h:t.s(r.tabsListStyle),i:s.scrollLeft,j:s.isFirstLoaded,k:t.o(((...t)=>r.scroll&&r.scroll(...t))),l:t.s({background:o.bgColor}),m:t.s(o.tabsStyle)}}],["__scopeId","data-v-3329b92d"]]);wx.createComponent(n);
